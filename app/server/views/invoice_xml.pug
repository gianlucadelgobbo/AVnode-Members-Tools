doctype xml
ns2:FatturaElettronica(versione='FPR12', xmlns:ns2='http://ivaservizi.agenziaentrate.gov.it/docs/xsd/fatture/v1.2')
  - var d = result.invoice_date;                      
  FatturaElettronicaHeader
    DatiTrasmissione
      IdTrasmittente
        IdPaese=udata.countrycode
        IdCodice=udata.fiscal_code.toUpperCase()
      ProgressivoInvio=result.invoice_number
      FormatoTrasmissione="FPR12"
      //valori ammessi: [FPA12] = fattura verso PA [FPR12] = fattura verso privati
      if result.to_client.unique_code
        CodiceDestinatario=result.to_client.unique_code
      if result.to_client.pec
        PECDestinatario=result.to_client.pec
    CedentePrestatore
      DatiAnagrafici
        IdFiscaleIVA
          IdPaese=_config.company.address.countrycode
          IdCodice=_config.company.vat_number
        CodiceFiscale=_config.company.fiscal_code
        Anagrafica
          Denominazione=_config.company.name.toUpperCase()
        RegimeFiscale="RF01"
      Sede
        Indirizzo=_config.company.address.street.toUpperCase()
        //numerocivico=_config.company.address.street
        CAP=_config.company.address.zipcode.toUpperCase()
        Comune=_config.company.address.city.toUpperCase()
        Provincia=_config.company.address.province.toUpperCase()
        Nazione=_config.company.address.countrycode
    CessionarioCommittente
      DatiAnagrafici
        IdFiscaleIVA
          IdPaese=result.to_client.address.countrycode
          IdCodice=result.to_client.vat_number.toUpperCase()
        CodiceFiscale=result.to_client.fiscal_code.toUpperCase()
        Anagrafica
          Denominazione=result.to_client.name.toUpperCase()
      Sede
        Indirizzo=result.to_client.address.street.toUpperCase()
        CAP=result.to_client.address.zipcode.toUpperCase()
        Comune=result.to_client.address.city.toUpperCase()
        Provincia=result.to_client.address.province.toUpperCase()
        Nazione=result.to_client.address.countrycode
  FatturaElettronicaBody
    DatiGenerali
      DatiGeneraliDocumento
        TipoDocumento="TD01"
        // TD04 nota di credito
        Divisa="EUR"
        Data=d.getUTCFullYear()+"-"+(("0" + (d.getUTCMonth()+1)).slice(-2))+"-"+(("0" + (d.getUTCDate())).slice(-2))
        Numero=result.invoice_number
        ImportoTotaleDocumento=result.total
    DatiBeniServizi
      - for(a=0;a<result.items.length;a++)
        DettaglioLinee
          NumeroLinea=(a+1)
          descrizione=result.items[a].description.toUpperCase()
          Quantita=result.items[a].quantity
          PrezzoUnitario=result.items[a].price
          PrezzoTotale=result.items[a].amount
          AliquotaIVA=result.vat_perc
    if result.bank && result.bank.name
      DatiPagamento
        CondizioniPagamento="TP02"
          // [TP01]: pagamento a rate
          // [TP02]: pagamento completo
          // [TP03]: anticipo
          DettaglioPagamento
            Beneficiario=_config.company.name.toUpperCase()
            ModalitaPagamento="MP05"
            DataRiferimentoTerminiPagamento=d.getUTCFullYear()+"-"+(("0" + (d.getUTCMonth()+1)).slice(-2))+"-"+(("0" + (d.getUTCDate())).slice(-2))
            - var d2 = new Date(d.getTime()+(60*24*60*60*1000))
            GiorniTerminiPagamento=result.payment_days
            DataScadenzaPagamento=d2.getUTCFullYear()+"-"+(("0" + (d2.getUTCMonth()+1)).slice(-2))+"-"+(("0" + (d2.getUTCDate())).slice(-2))
            ImportoPagamento=result.total
            IstitutoFinanziario=result.bank.name
            IBAN=result.bank.IBAN
            CAB=result.bank.CAB
            ABI=result.bank.ABI
          
          